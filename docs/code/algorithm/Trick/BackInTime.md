---
title: 时光倒流
tags:
  - BackInTime
---

# 时光倒流

时光倒流是一种处理动态连通性问题的技巧。它的核心思想是将操作顺序反转，通过从最后一个操作开始逆序处理操作，从而简化问题的复杂度。

???+ note "[航线规划](https://www.luogu.com.cn/problem/P2542){target=_blank}"

    给定一张有 $n$ 个节点和 $m$ 条边的无向连通图。初始时图中包含所有边。现在有 $q$ 次操作, 每次操作要么删除一条边, 要么询问两点间的关键边数量（$u$ 和 $v$ 之间的边, 如果删除该边会使得 $u$ 和 $v$ 不连通, 则该边为关键边）。请你回答所有询问。保证任意时刻图仍然连通。

    ??? hint
    
        由于删除边最后仍然连通，说明删除的边都是非关键边。因此可以将所有删除操作逆序处理, 相当于每次加入一条边。而加入边不会增加关键边的数量, 只会减少关键边的数量。因此可以使用树链剖分维护当前图的关键边数量。

        注意删除操作完成后图仍可能有非关键边，这些边会对树边的关键性产生影响，因此在逆序处理时也需要将这些非关键边加入图中。

    ```cpp
    --8<-- "code/Trick/BackInTime/P2542.cpp"
    ```