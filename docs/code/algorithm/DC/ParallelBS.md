---
title: 整体二分
tags:
  - Parallel Binary Search
---

# 整体二分

整体二分（$\text{Parallel Binary Search}$）是一种用于处理离线查询的分治算法，常用于答案具有单调性的离线查询问题，即查询答案随某个参数（如时间、权值、操作次数）单调变化的情况。

## 区间查询

整体二分的基本思想是将所有查询的答案范围进行二分，然后在每次二分中，批量处理所有查询，判断哪些查询在当前中点满足条件，从而缩小查询的答案范围。在二分的中点 $mid$，暂时假设所有操作 $\leq mid$ 已生效，然后判断哪些查询已经满足条件。

整体二分的步骤：

1. 初始化每个查询的答案范围为 $[L, R]$，通常为问题中可能的最小值和最大值
2. 重复以下步骤直到所有查询的答案范围收敛：

      1. 对于每个查询，计算当前中点 $mid = (L + R) / 2$
      2. 将所有查询按照 $mid$ 分组
      3. 对于每个 $mid$，模拟执行所有操作 $≤ mid$
      4. 对于每个查询，检查当前状态是否满足查询条件。如果满足，更新答案范围为 $[L, mid]$（即答案可能更小）。否则，更新答案范围为 $[mid + 1, R]$（即答案更大）

1. 最终每个查询的答案即为其收敛后的 $L$

!!! tip "与线段树分治的区别"

    线段树分治是将时间维度引入线段树结构中，处理动态修改和查询的问题。而整体二分则是通过对查询答案范围进行二分来批量处理离线查询问题。两者都是分治思想的应用，但侧重点不同。

???+ note "[【模板】可持久化线段树 2](https://www.luogu.com.cn/problem/P3834){target=_blank}"

    给定 $n$ 个整数构成的序列，将对于指定的闭区间 $[l,r]$ 查询其区间内的第 $k$ 小值

    === "整体二分"
        
        !!! tip "时间复杂度"

            $O((n+q) \log^{2} n)$，其中 $n$ 为序列长度，$q$ 为查询次数。

        ```cpp
        --8<-- "code/DC/ParallelBS/P3834_1.cpp"
        ```

    === "静态序列优化"

        !!! tip "分治中心维护"

            通过维护全局指针来避免重复计算，将树状数组的多次清空重建改为单次顺序更新。这种方法不需要对询问做出修改。

            时间复杂度仍为 $O((n+q) \log^{2} n)$，但常数项更小。

        ```cpp
        --8<-- "code/DC/ParallelBS/P3834_2.cpp"
        ```

## 带修改的区间查询

修改操作会影响查询结果时，可以将修改操作和查询操作一起离线处理，每次修改操作可以视作将一个元素从旧值修改为新值的两次操作。

???+ note "[Dynamic Rankings](https://www.luogu.com.cn/problem/P2617){target=_blank}"

    ```cpp
    --8<-- "code/DC/ParallelBS/P2617.cpp"
    ```