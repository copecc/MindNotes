---
title: 拓扑排序
tags:
  - 拓扑排序
  - Topological Sort
  - Critical Path
---

# 拓扑排序

拓扑排序（$\text{Topological Sort}$）是一种对有向无环图（$\text{DAG}$）进行线性排序的算法。它将图中的所有顶点排成一个线性序列，使得对于每一条有向边 $(u, v)$，顶点 $u$ 在序列中出现在顶点 $v$ 之前。

拓扑排序的常见实现方法有两种：基于入度的 $\text{Kahn}$ 算法和基于深度优先搜索（$\text{DFS}$）的算法。

- $\text{Kahn算法}$：通过计算每个顶点的入度，选择入度为零的顶点进行排序，并更新其邻接顶点的入度，直到所有顶点都被排序。
- $\text{DFS算法}$：对图进行深度优先搜索，在访问完一个顶点后，将其加入结果序列中，最终将序列反转得到拓扑排序结果。

???+ note "[【模板】拓扑排序](https://www.luogu.com.cn/problem/B3644){target=_blank}"

    给定一个有向无环图，输出其拓扑排序结果。使用 $\text{Kahn}$ 算法实现。

    ```cpp
    --8<-- "code/Graph/TopoSort/B3644.cpp"
    ```

!!! tip "字典序最大/最小的拓扑排序"

    可以使用优先队列（$\text{priority\_queue}$）来实现字典序最大或最小的拓扑排序。在 $\text{Kahn}$ 算法中，替换普通队列为优先队列，并根据需要选择最大堆或最小堆。

## 关键路径

关键路径是指在有向无环图（$\text{DAG}$）中，从起始节点到终止节点的最长路径。关键路径通常用于项目管理和调度，以确定项目的最短完成时间。

### AOV网中的关键路径

在 $\text{AOV}$ 网中，任务表示为顶点，任务之间的依赖关系表示为有向边，每个顶点都有一个与之关联的任务时间。通过拓扑排序，可以计算每个任务的最早开始时间和最早结束时间，从而确定关键路径。

关键路径是指从起始节点到终止节点的最长路径, 其长度表示完成所有任务所需的最短时间。关键路径上的任务是项目中最重要的任务，任何这些任务的延迟都会直接影响整个项目的完成时间。

???+ note "[杂务](https://www.luogu.com.cn/problem/P1113){target=_blank}"

    给定一组任务及其依赖关系，计算完成所有任务所需的最短时间。

    ```cpp
    --8<-- "code/Graph/TopoSort/P1113.cpp"
    ```

### AOE网中的关键路径

在 $\text{AOE}$ 网中，任务表示为有向边，节点表示事件。每条边都有一个与之关联的任务时间。通过拓扑排序，可以计算每个事件的最早发生时间和最晚发生时间，从而确定关键路径。

关于关键路径的定义和计算，可以从事件和活动两个角度进行描述：

1. 事件的最早发生时间（$\text{Earliest Event Time, EET}$）：事件可以发生的最早时间。事件 $v$ 的 $\text{EET}$ 定义为所有指向 $v$ 的边的起始事件的 $\text{EET}$ 加上边的权重的最大值，即 $\text{EET}(v) = \max_{(u,v) \in E}(\text{EET}(u) + w(u,v))$。特别地，没有入边的事件的 $\text{EET}$ 定义为 $0$。
2. 事件的最晚发生时间（$\text{Latest Event Time, LET}$）：事件必须发生的最晚时间，以不延误整个项目的完成时间。事件 $u$ 的 $\text{LET}$ 定义为所有从 $u$ 出发的边的终止事件的 $\text{LET}$ 减去边的权重的最小值，即 $\text{LET}(u) = \min_{(u,v) \in E}(\text{LET}(v) - w(u,v))$。特别地，没有出边的事件的 $\text{LET}$ 和其 $\text{EET}$ 相等。
3. 关键事件：如果一个事件的 $\text{EET}$ 等于其 $\text{LET}$，则该事件被称为关键事件。关键事件位于关键路径上，任何关键事件的延迟都会直接影响整个项目的完成时间。

---

1. 活动的最早开始时间（$\text{Earliest Start Time, EST}$）：活动可以开始的最早时间。活动 $(u, v)$ 的 $\text{EST}$ 定义为起始事件 $u$ 的 $\text{EET}$，即 $\text{EST}(u, v) = \text{EET}(u)$。
2. 活动的最晚开始时间（$\text{Latest Start Time, LST}$）：活动必须开始的最晚时间，以不延误整个项目的完成时间。活动 $(u, v)$ 的 $\text{LST}$ 定义为终止事件 $v$ 的 $\text{LET}$ 减去活动的持续时间，即 $\text{LST}(u, v) = \text{LET}(v) - w(u, v)$。
3. 关键活动：如果一个活动的 $\text{EST}$ 等于其 $\text{LST}$，则该活动被称为关键活动。关键活动位于关键路径上，任何关键活动的延迟都会直接影响整个项目的完成时间。


???+ note "[关键路径](https://www.luogu.com.cn/problem/T219648){target=_blank}"

    给定一个有向无环图，计算其关键路径上的所有事件。

    ```cpp
    --8<-- "code/Graph/TopoSort/T219648.cpp"
    ```